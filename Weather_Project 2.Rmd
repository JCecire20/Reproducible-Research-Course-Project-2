---
title: "Severe Weather Events and Health"
author: "J Cecire"
date: "9/9/2021"
output: html_document
---
## Synopsis

## Questions

1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

## Loading Packages 
```{r setup, echo=TRUE}
library(dplyr)
library(knitr)
```

## Loading Data
```{r setup, echo=TRUE}
stormData <- read.csv("./repdata-data-StormData.csv.bz2")
summary(stormData)
names(stormData)
str(stormData)
```

# Wranggling Data

## Extracting needed Variables
Since for the rest of this analysis we will only be focusing on events that either harm the populations health or impact the economy we can wrangle and consolodate the data getting rid of unnecessary columns. The columns we will focus on are as follows:

EVTYPE: Event Type (Tornados, Flood, â€¦.)

FATALITIES: Number of Fatalities

INJURIES: Number of Injuries

PROPDMG: Property Damage

PROPDMGEXP: Units for Property Damage (magnitudes - K,B,M)

CROPDMG: Crop Damage

CROPDMGEXP: Units for Crop Damage (magnitudes - K,BM,B)
```{r, echo=TRUE}
keyVars <- c("EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP", "CROPDMG", "CROPDMGEXP")
storm <- stormData[keyVars]
dim(storm)
names(storm)
summary(storm)
str(storm)
```

## Making the PROPDMGEXP and CROPDMGEXP columns cleaner so they can be used to calculate property and crop cost.
```{r, echo=TRUE}
unique(storm$PROPDMGEXP)
```

```{r, echo=TRUE}
storm$PROPDMGEXP <- recode(storm$PROPDMGEXP, 
                              "K" = 10^3, "M" = 10^6, " " = 1, "B" = 10^9, "m" =10^6, "+" = 0, '0' = 1, '5' = 10^5, '6' =10^6, "?" = 0, '4' = 10^4, '2' = 10^2, '3' = 10^3, "h" = 10^2, '7' = 10^7, "H" = 10^2, "-" = 0, '1' = 10, '8' = 10^8)

storm$PROPDMGEXP <- as.numeric(as.character(storm$PROPDMGEXP))
storm$PROPDMGTOTAL <- (storm$PROPDMG * storm$PROPDMGEXP)/1000000000
```

```{r, echo=TRUE}
unique(storm$CROPDMGEXP)
```

```{r, echo=TRUE}
storm$CROPDMGEXP <- recode(storm$CROPDMGEXP, 
                              " " = 1,"M" = 10^6, "K" = 10^3, "m" = 10^6, "B" = 10^9, "?" = 0, "0" = 1, "k" = 10^3,"2" = 10^2)

storm$CROPDMGEXP <- as.numeric(as.character(storm$CROPDMGEXP))
storm$CROPDMGTOTAL <- (storm$CROPDMG * storm$CROPDMGEXP)/1000000000
```

## Which type of events are most harmful to human health?

### Fatalities 
```{r, echo=TRUE}
stormFatalities <- aggregate(FATALITIES ~ EVTYPE, data = storm,  FUN="sum")
dim(stormFatalities)
names(stormFatalities)
summary(stormFatalities)
str(stormFatalities)
```

- Since there are 985 different event types we are only going to look at the top 10 most fatal events.
```{r, echo=TRUE}
top10FatalEvents <- stormFatalities[order(-stormFatalities$FATALITIES), ][1:10, ]
top10FatalEvents

```
### Plot Fatalities
```{r, echo=TRUE}
par(mfrow = c(1,1), mar = c(10, 4, 4, 2), mgp = c(3, 1, 0), cex = 0.7)
barplot(top10FatalEvents$FATALITIES, names.arg = top10FatalEvents$EVTYPE, las = 3, 
        main = "Top 10 Fatal Events", 
        ylab = "Number of Fatalities",
        ylim = range(0,6000),
        col = c("red"))

```


### Injuries
```{r, echo=TRUE}
stormInjuries <- aggregate(INJURIES ~ EVTYPE, data = storm,  FUN="sum")
dim(stormInjuries)
names(stormInjuries)
summary(stormInjuries)
str(stormInjuries)
```

- Since there are 985 different event types we are only going to look at the top 10 injury events.
```{r, echo=TRUE}
top10InjuryEvents <- stormInjuries[order(-stormInjuries$INJURIES), ][1:10, ]
top10InjuryEvents
```

### Plot Injuries
```{r, echo=TRUE}
options(scipen = 100)
par(mfrow = c(1,1), mar = c(11, 6, 4, 2), mgp = c(3, 1, 0), cex = 0.7)
barplot(top10InjuryEvents$INJURIES, names.arg = top10InjuryEvents$EVTYPE, las = 3, 
        main = "Top 10 Injury Events", 
        ylab = "Number of Injuries",
        ylim = range(0,100000),
        col = c("Orange"))

```

## Which type of events have the greatest economic consequences? 

### Property Damage

```{r pressure, echo=TRUE}
stormPropDmg <- aggregate(PROPDMGTOTAL ~ EVTYPE, data = storm,  FUN="sum")
dim(stormPropDmg)
names(stormPropDmg)
summary(stormPropDmg)
str(stormPropDmg)
```

- Since there are 985 different event types we are only going to look at the top 10 most property damaging events.
```{r, echo=TRUE}
top10PropDmgEvents <- stormPropDmg[order(-stormPropDmg$PROPDMGTOTAL), ][1:10, ]
top10PropDmgEvents

```

### PLot Property Damage
```{r, echo=TRUE}
par(mfrow = c(1,1), mar = c(12, 6, 4, 2), mgp = c(3, 1, 0), cex = 0.7)
barplot(top10PropDmgEvents$PROPDMGTOTAL, names.arg = top10PropDmgEvents$EVTYPE, las = 3, 
        main = "Top 10 Property Damage Events", 
        ylab = "Property Damage Values (in Billions)",
        ylim = range(0,200),
        col = c("Black"))

```

### Crop Damage

```{r pressure, echo=TRUE}
stormCropDmg <- aggregate(CROPDMGTOTAL ~ EVTYPE, data = storm,  FUN="sum")
dim(stormCropDmg)
names(stormCropDmg)
summary(stormCropDmg)
str(stormCropDmg)
```

- Since there are 985 different event types we are only going to look at the top 10 most property damaging events.
```{r, echo=TRUE}
top10CropDmgEvents <- stormCropDmg[order(-stormCropDmg$CROPDMGTOTAL), ][1:10, ]
top10CropDmgEvents

```


### Plot Crop Damage
```{r, echo=TRUE}
par(mfrow = c(1,1), mar = c(12, 6, 4, 2), mgp = c(3, 1, 0), cex = 0.7)
barplot(top10CropDmgEvents$CROPDMGTOTAL, names.arg = top10CropDmgEvents$EVTYPE, las = 3, 
        main = "Top 10 Crop Damage Events", 
        ylab = "Crop Damage Values (in Billions)",
        ylim = range(0,20),
        col = c("Green"))

```

